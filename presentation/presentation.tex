\documentclass{beamer}
\usetheme{Antibes}
\usepackage{epstopdf}
\usepackage{tikz}
\usetikzlibrary{chains}
\usepackage{listings}

\lstdefinestyle{mystyle}{                  
    basicstyle=\tiny
}
\title[Cyber Range]{Design and Developement of a Cyber Range}
% \subtitle{Using Beamer}
\author[A. Mocanu]{Alexandru Mocanu}
\institute[UniTo]{Università Degli Studi di Torino\\ Dipartimento di Informatica}
\date{\today}

\begin{document}


\begin{frame}
    \titlepage
\end{frame}

\begin{frame}
    \frametitle{Outline}

    \tableofcontents

\end{frame}

\section{Cyber Range}
\begin{frame}
    \frametitle{Cyber Range}

    È un ambiente virtuale usato da professionisti, e non, per testare:
    \begin{itemize}
        \item Affidabilità
        \item Sicurezza
        \item Prestazioni
    \end{itemize}
    di infrastrutture e sistemi IT.
\end{frame}

\section{CTF - Capture the Flag}
\begin{frame}
    \frametitle{CTF - Capture the Flag}

    È un gioco di \textbf{hacking} dove team (o singoli) cercano \textbf{vulnerabilità} in sistemi
    e software messi a disposizione dagli organizzatori della competizione al fine di sfruttarle e 
    di collezionare le varie \textbf{flag} nascoste sul sistema bersaglio.
    

\end{frame}
\subsection{Tipologie CTF}
\begin{frame}
    \frametitle{Tipologie CTF}
    Ci sono vari tipi di Capture the Flag, i più famosi sono:
    \begin{itemize}
        \item Jeopardy
        \item Attack/Defense
        \item Boot2Root
    \end{itemize}
    

\end{frame}

\begin{frame}
    \frametitle{CTF - Jeopardy}
    I CTF di tipo Jeopardy sono probabilmente i più popolari, dato che si adattano bene a competizioni online.
    \\
    In questo formato:
    \begin{itemize}
        \item<1-> diverse \textit{challenge}, ognuna con un singolo \textit{flag}
        \item<2-> \textbf{punteggio}: a seconda della difficoltà della singola \textit{challenge}
        \item<3-> \textbf{vincitore}: chi totalizza il punteggio maggiore
        \item<4-> \textbf{durata}: a tempo
    \end{itemize}

    \onslide<5->{Generalmente con questo tipo di formato i partecipanti formano squadre,
    le quali assegnano una challenge a uno o più membri della squadra, per velocizzare 
    la risoluzione delle challenge e la conquista delle flag.}
    
    

\end{frame}

\begin{frame}
    \frametitle{CTF - Attack/Defense}
    Il formato Attack/Defense prevede che gli organizzatori 
    forniscano ai giocatori (principalmente squadre) una o più macchine virtuali.
    \\~\\
    \onslide<2->{I giocatori quindi avranno un doppio ruolo:}
    \begin{itemize}
        \item <3->\textbf{difendere} i servizi esposti sulla propria macchina virtuale
        \item <4->\textbf{attaccare} i servizi dei team concorrenti
    \end{itemize}
    \leavevmode \\~\\
    \onslide<5->{Si guadagna un \textbf{punteggio} per ogni flag conquistato.}
    \\~\\
    \onslide<6->{Generalmente sono eventi \textit{offline} e con un limite di tempo.}

\end{frame}

\begin{frame}
    \frametitle{CTF - Boot2Root}
    Consiste l'installazione di una \textit{macchina virtuale} e lo scopo è di trovare e sfruttarne le
    vulnerabilità che permettano di avere l'accetto root alla stessa.
    \\~\\
    \onslide<2->{Questo formato di CTF è principalmente preferito da singoli 
    che vogliono esercitarsi a sfruttare vulnerabilità in uno scenario 
    semi-reale, ma non preclude la possibilità di creare un team.}

\end{frame}



\section{Scenario immaginato}

\begin{frame}
    \frametitle{Scenario}

    \includegraphics[width=\textwidth]{competition.pdf}

\end{frame}

\section{Tools \& Software}
\begin{frame}
    \frametitle{Software}
    \begin{itemize}
        \item <1-> iptables
        \item <2-> netplan
        \item <3-> script python
        \item <4-> script bash
    \end{itemize}
\end{frame}


\subsection*{iptables}
\begin{frame}
    \frametitle{Definizione}

    Iptables è un potente firewall integrato nel kernel Linux.
    Permette di definire, tramite regole, il filtraggio, la manipolazione dei pacchetti ed il NAT.
    \\~\\
    È strutturato in \textbf{tabelle}, ognuna contiene le proprie \textbf{catene} che possono, anche, essere definite dall'utente.
    \\~\\
    Ogni catena è una \textit{lista di regole} che specificano l'\textbf{azione} da intraprendere con i pacchetti che corrispondono alla regole.
    \\~\\
    Quest'\textit{azione} corrisponde al \textbf{target}.

\end{frame}

\begin{frame}
    \frametitle{TARGETS}

    Una regola di firewall specifica il criterio di selezione dei pacchetti ed il \textbf{target}.
    \\~\\
    Se il pacchetto non corrisponde $\rightarrow$ verrà esaminata la regola successiva.\\
    Se il pacchetto corrisponde $\rightarrow$ verrà intrapresa l'azione definita dal \textit{target}, che può essere:
    \begin{itemize}
        \item ACCEPT
        \item DROP
        \item RETURN
        \item catena definita dall'utente
    \end{itemize}

\end{frame}


\begin{frame}
    \frametitle{CHAINS}

    

\end{frame}


\begin{frame}
    \frametitle{TABLES}
    Ci sono 5 tabelle indipendenti:
    \begin{description}
        \item[filter]<1-> defr
        \item[nat]<2->
        \item[mangle]<3->
        \item[raw]<4->
        \item[security]<5->    
    \end{description}
\end{frame}

\subsection*{netplan}


\subsection*{script python}


\subsection*{script bash}


\section{Regole Firewall}




\subsection{Fase 1}
\subsubsection{Obiettivi}
\begin{frame}
    \frametitle{Obiettivi Fase 1}
    \begin{itemize}
        \item<1-> Isolamento dei Team
        \item<2-> Solo Management e Virtual Router possono iniziare una connessione verso gli altri
        \item<3-> Solo Management e Virtual Router possono connettersi all'esterno, attraverso l'UPLINK
        \item<4-> LOG dei pacchetti entranti e dei pacchetti inoltrati
    \end{itemize}

\end{frame}

\lstset{style=mystyle}
\subsubsection{Regole specifiche per il Virtual Router}
\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Virtual Router}
    Connessione all'esterno attraverso UPLINK
    \\~\\
    \begin{lstlisting}[language=sh]
        $ iptables -P OUTPUT ACCEPT

        
        $ iptables -P INPUT DROP
        

        $ iptables -A INPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT           
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Virtual Router}
    Ricevere connessioni da MANAGEMENT (qualsiasi tipo)
    \\~\\
    \begin{lstlisting}[language=sh]
        $ iptables -P INPUT DROP
        
        
        $ iptables -A INPUT -i $MANAGEMENT_INTERFACE -j ACCEPT
        
        
        $ iptables -P OUTPUT ACCEPT           
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Virtual Router}
    Connessioni ai TEAM e ricezione risposta
    \\~\\
    \begin{lstlisting}[language=sh]
        $ iptables -P OUTPUT ACCEPT
        
        
        $ iptables -A INPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT           
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Virtual Router}
    Connessione loopback
    \\~\\
    \begin{lstlisting}[language=sh]
        $ iptables -P OUTPUT ACCEPT


        $ iptables -A INPUT -i lo -j ACCEPT           
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Virtual Router}
    Blocco connessioni dall'esterno e dai TEAM (se non iniziate da VR)
    \\~\\
    \begin{lstlisting}[language=sh]
        $ iptables -P INPUT DROP


        $ iptables -A INPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT
    \end{lstlisting}
\end{frame}


\subsubsection{Regole specifiche per il Management}
\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Management}
    Connessione all'esterno attraverso UPLINK
    \\~\\
    \begin{lstlisting}
        $ iptables -P FORWARD DROP

        
        $ iptables -t nat -A POSTROUTING -o $UPLINK -j MASQUERADE
        
        
        $ iptables -A FORWARD -i $MANAGEMENT_INTERFACE -j ACCEPT
        
        
        $ iptables -A FORWARD -m conntrack --ctstate ESTABLISHED -j ACCEPT
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Management}
    Connessione al VIRTUAL ROUTER
    \\~\\
    \begin{lstlisting}
        $ iptables -P INPUT DROP
        
        
        $ iptables -A INPUT -i $MANAGEMENT_INTERFACE -j ACCEPT
        
        
        $ iptables -P OUTPUT ACCEPT

    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Management}
    Connessione ai TEAM
    \\~\\
    \begin{lstlisting}
        $ iptables -P FORWARD DROP
        
        
        $ iptables -A FORWARD -i $MANAGEMENT_INTERFACE -j ACCEPT
        
        
        $ iptables -A FORWARD -m conntrack --ctstate ESTABLISHED -j ACCEPT
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Management}
    Blocco connessioni dall'esterno e dai TEAM (se non iniziate da MANAGEMENT)
    \\~\\
    \begin{lstlisting}[language=sh]
        $ iptables -P INPUT DROP


        $ iptables -A INPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT
    \end{lstlisting}
\end{frame}

\subsubsection{Regole specifiche per i Team}
\begin{frame}[fragile]
    \frametitle{Regole specifiche per i Team}
    Rispondere a connessioni iniziate da MANAGEMENT
    \\~\\
    \begin{lstlisting}
        $ iptables -P FORWARD DROP
        
        
        $ iptables -A FORWARD -m conntrack --ctstate ESTABLISHED -j ACCEPT
    \end{lstlisting}

\end{frame}
\begin{frame}[fragile]
    \frametitle{Regole specifiche per i Team}
    Rispondere a connessioni iniziate da VR
    \\~\\
    \begin{lstlisting}
        $ iptables -P INPUT DROP
        
        
        $ iptables -A INPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT
    \end{lstlisting}

\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per i Team}
    Blocco inizio connessioni verso:
    \begin{itemize}
        \item MANAGEMENT
            \begin{lstlisting}
        $ iptables -P FORWARD DROP
            \end{lstlisting}
        \item VIRTUAL ROUTER
            \begin{lstlisting}
        $ iptables -P INPUT DROP  
            \end{lstlisting}
        \item altri TEAM
            \begin{lstlisting}
        $ iptables -P FORWARD DROP
            \end{lstlisting}
        \item esterno tramite UPLINK
            \begin{lstlisting}
        $ iptables -P FORWARD DROP
            \end{lstlisting}
    \end{itemize}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole per il LOG}
    LOG dei pacchetti entranti
    \\~\\
    \begin{lstlisting}
    $ iptables -N LOGGING
    
    
    $ iptables -A INPUT -j LOGGING
    
    
    $ iptables -A LOGGING -m limit --limit $LOGLIMIT -j LOG --log-prefix 
            "COMPETITION-LOG: " --log-level 4

    \end{lstlisting}

\end{frame}


\begin{frame}[fragile]
    \frametitle{Regole per il LOG}
    LOG dei pacchetti inoltrati
    \\~\\
    \begin{lstlisting}
    $ iptables -N LOGGING


    $ iptables -A LOGGING -m limit --limit $LOGLIMIT -j LOG --log-prefix 
            "COMPETITION-LOG: " --log-level 4
    
    
    $ iptables -A FORWARD -j LOGGING
    \end{lstlisting}

\end{frame}

\subsection{Fase 2}
\subsubsection{Obiettivi}
\begin{frame}
    \frametitle{Obiettivi Fase 2}
    \begin{itemize}
        \item<1-> Solo Management e Virtual Router possono iniziare una connessione verso chiunque
        \item<2-> Solo Management e Virtual Router possono connettersi all'esterno, attraverso l'UPLINK
        \item<3-> Team possono comunicare tra loro
        \item<4-> Team non possono iniziare connessioni verso MANAGEMENT e VIRTUAL ROUTER
        \item<4-> LOG dei pacchetti entranti e dei pacchetti inoltrati
    \end{itemize}
    

\end{frame}
\subsubsection{Regole specifiche per il Virtual Router}
\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Virtual Router}
    Le regole rimangono le stesse della FASE 1
\end{frame}


\subsubsection{Regole specifiche per il Management}
\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Management}
    Connessione all'esterno attraverso UPLINK
    \\~\\
    \begin{lstlisting}
        $ iptables -P FORWARD ACCEPT
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Management}
    Connessione al VIRTUAL ROUTER
    \\~\\
    \begin{lstlisting}
        $ iptables -P INPUT DROP
        
        
        $ iptables -A INPUT -i $MANAGEMENT_INTERFACE -j ACCEPT
        
        
        $ iptables -P OUTPUT ACCEPT

    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Management}
    Connessione ai TEAM
    \\~\\
    \begin{lstlisting}
        $ iptables -P FORWARD ACCEPT
        
        
        $ iptables -A FORWARD -m conntrack --ctstate ESTABLISHED -j ACCEPT
    \end{lstlisting}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per il Management}
    Blocco connessioni dall'esterno e dai TEAM (se non iniziate da MANAGEMENT)
    \\~\\
    \begin{lstlisting}[language=sh]
        $ iptables -P FORWARD ACCEPT 
        
        
        $ iptables -A FORWARD -m conntrack --ctstate ESTABLISHED -j ACCEPT
        
        
        $ iptables -A FORWARD -o $MANAGEMENT_INTERFACE -j DROP        
    \end{lstlisting}
\end{frame}

\subsubsection{Regole specifiche per i Team}
\begin{frame}[fragile]
    \frametitle{Regole specifiche per i Team}
    Rispondere a connessioni iniziate da MANAGEMENT
    \\~\\
    \begin{lstlisting}
        $ iptables -P FORWARD ACCEPT 
        
        
        $ iptables -A FORWARD -m conntrack --ctstate ESTABLISHED -j ACCEPT
        
        
        $ iptables -A FORWARD -o $MANAGEMENT_INTERFACE -j DROP
    \end{lstlisting}

\end{frame}
\begin{frame}[fragile]
    \frametitle{Regole specifiche per i Team}
    Rispondere a connessioni iniziate da VR
    \\~\\
    \begin{lstlisting}
        $ iptables -P INPUT DROP
        
        
        $ iptables -A INPUT -m conntrack --ctstate ESTABLISHED -j ACCEPT
    \end{lstlisting}

\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per i Team}
    Connessioni verso altri TEAM
    \\~\\
    \begin{lstlisting}
        $ iptables -P FORWARD ACCEPT
    \end{lstlisting}

\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole specifiche per i Team}
    Blocco inizio connessioni verso:
    \begin{itemize}
        \item MANAGEMENT
            \begin{lstlisting}
        $ iptables -P FORWARD ACCEPT


        $ iptables -A FORWARD -o $MANAGEMENT_INTERFACE -j DROP
            \end{lstlisting}
        \item VIRTUAL ROUTER
            \begin{lstlisting}
        $ iptables -P INPUT DROP  
            \end{lstlisting}
        \item esterno tramite UPLINK
            \begin{lstlisting}
        $ iptables -P FORWARD ACCEPT


        $ iptables -A FORWARD -o $UPLINK -j DROP
            \end{lstlisting}
    \end{itemize}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole per il LOG}
    Le regole sono le stesse della FASE 1
\end{frame}

\begin{frame}
    \frametitle{NAT}
    \onslide<1-> {Il NAT, ovvero \textit{Network Address Translation}, conosciuto anche come \textbf{network masquerading}, è una tecnica
    che consiste nel modificare gli \textbf{indirizzi IP} contenuti negli \textbf{header} dei pacchetti in transito su
    un sistema che agisce da \textbf{router} all'interno di una comunicazione tra due o più \textit{host}.}
    \\~\\
    \onslide<2-> {Nel nostro caso verrà mascherato l'indirizzo sorgente del pacchetto.}

\end{frame}

\begin{frame}
    \frametitle{MASQUERADING}
    Lo script è stato ideato per permettere quattro situazioni di \textit{masquerading}:
    \begin{itemize}
        \item <1-> Un indirizzo unico per tutti i TEAM\onslide <2->{, che può essere:}
        \begin{itemize}
            \item<2-> definito dall'amministratore di gara
            \item<3-> generato in modo casuale
        \end{itemize}
        \item<4-> Indirizzi diversi per tutti i TEAM\onslide <5->{, che possono essere:}
        \begin{itemize}
            \item <5-> definiti dall'amministratore di gara
            \item <6-> generati in modo casuale
        \end{itemize}
    \end{itemize}
\end{frame}

\begin{frame}[fragile]
    \frametitle{Regole per il Masquerading}

    La regola per il \textbf{masquerading} è strutturata in questo modo:
    \\~\\
    \begin{lstlisting}
    $ iptables -t nat -A POSTROUTING -o $interface -j SNAT 
            --to-source $MASQUERADING_ADDRESS
    \end{lstlisting}
\end{frame}





\section{Test delle prestazioni}
\begin{frame}
    \frametitle{}

    

\end{frame}


\end{document}


